<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Electron Fetch Demo</title>
    <style>
      body { font-family: sans-serif; margin: 20px; }
      #output { white-space: pre-wrap; margin-top: 1em; }
    </style>
  </head>
  <body>
    <h2>API Fetcher</h2>
    <!-- The droplist -->
    <p>
     <select id="urlHistory" width="80%">
      <option value="">-- Select a URL --</option>
    </select>
    </p>
    <input id="urlInput" type="text" size="50"
           value="" />
    <button id="fetchBtn">Fetch</button>
    <div id="output"></div>

    <script>
      const urlInput = document.querySelector("#urlInput");
      const fetchBtn = document.querySelector("#fetchBtn");
      const output = document.querySelector("#output");
      const urlHistory = document.querySelector("#urlHistory");

      document.addEventListener('DOMContentLoaded', () => getUrlsFromLocalStorage());
      urlHistory.addEventListener('change', () => {
         console.log("i've changed...");
       var selectedUrl = urlHistory.value;
       if (selectedUrl) {
         urlInput.value = selectedUrl;
       }
      });
      var allUrls = [];
      fetchBtn.addEventListener('click', () => {
        const url = urlInput.value.trim();
        if (!url) return;

        output.textContent = 'Loading...';

        fetch(url)
          .then(res => res.json())
          .then(data => {
            output.textContent = JSON.stringify(data, null, 2);
            addToUrlHistory(url);
          })
          .catch(err => {
            output.textContent = 'Error: ' + err.message;
          });
      });

      function getUrlsFromLocalStorage(){
         // gets all the unique URLs the user has posted
         // from localStorage
         allUrls = JSON.parse(localStorage.getItem("urls"));
         // if there are some stored URLs then we'll load the droplist
         if (allUrls){
            loadDropList();
         }
      }

      function loadDropList(){
         console.log("in loadDropList...");
        var urlHistoryEl = document.querySelector("#urlHistory"); 
         allUrls.forEach(url => {
            const option = document.createElement('option');
            option.value = url;
            option.textContent = url;
            urlHistoryEl.appendChild(option);
         });
      }

      function addToUrlHistory(newUrl){
         allUrls = JSON.parse(localStorage.getItem("urls"));
         // check to see if URL has been added before
         var isNewUrl = true;         
         if (allUrls != null){
            allUrls.forEach(u => {
               if (u == newUrl){
                  isNewUrl = false;
               }});
         } 
         if (isNewUrl)
         {
            var urlHistoryEl = document.querySelector("#urlHistory");
            if (allUrls == null){allUrls = [];}
            allUrls.push(newUrl);
            localStorage.setItem("urls",JSON.stringify(allUrls));
            // insert into droplist
            const option = document.createElement('option');
            option.value = newUrl;
            option.textContent = newUrl;
            urlHistoryEl.appendChild(option);
         }
      }
    </script>
  </body>
</html>

